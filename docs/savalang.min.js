class Token{constructor(e,t){this.type=e,this.value=t}}class Lexer{constructor(e){this.code=e,this.position=0,this.currentChar=this.code[this.position]}advance(){this.position++,this.currentChar=this.code[this.position]}isLetter(e){return/[a-zA-Z]/.test(e)}isDigit(e){return/[0-9]/.test(e)}getNextToken(){for(;void 0!==this.currentChar;)if(/\s/.test(this.currentChar))this.advance();else{if("#"!==this.currentChar){if("!"===this.currentChar){let e=this.currentChar;return this.advance(),new Token("LABEL",e)}if("<"===this.currentChar)return this.advance(),"<"===this.currentChar?(this.advance(),new Token("OUTPUT","<<")):"="===this.currentChar?(this.advance(),new Token("LTE","<=")):new Token("LT","<");if(">"===this.currentChar)return this.advance(),"="===this.currentChar?(this.advance(),new Token("GTE",">=")):new Token("GT",">");if(":"===this.currentChar)return this.advance(),"="===this.currentChar?(this.advance(),new Token("ASSIGN",":=")):new Token("COLON",":");if("="===this.currentChar)return this.advance(),new Token("ASSIGN","=");if("+"===this.currentChar)return this.advance(),"+"===this.currentChar?(this.advance(),new Token("INCREMENT","++")):"="===this.currentChar?(this.advance(),new Token("INCREASEBY","+=")):new Token("PLUS","+");if("-"===this.currentChar)return this.advance(),"-"===this.currentChar?(this.advance(),new Token("DECREMENT","--")):"="===this.currentChar?(this.advance(),new Token("DECREASEBY","-=")):new Token("MINUS","-");if(/[a-zA-Z]/.test(this.currentChar)){let e="";for(;this.isLetter(this.currentChar)||this.isDigit(this.currentChar);)e+=this.currentChar,this.advance();return new Token("sava"===e?"SAVA":"as"===e?"AS":"number"===e?"NUMBER_TYPE":"string"===e?"STRING_TYPE":"goto"===e?"GOTO":"if"===e?"IF":"then"===e?"THEN":"IDENTIFIER",e)}if(this.isDigit(this.currentChar)){let e="";for(;this.isDigit(this.currentChar);)e+=this.currentChar,this.advance();return new Token("NUMBER",parseInt(e))}if('"'===this.currentChar){let e="";for(this.advance();'"'!==this.currentChar&&void 0!==this.currentChar;)e+=this.currentChar,this.advance();return this.advance(),new Token("STRING",e)}throw new Error(`Invalid character: ${this.currentChar}`)}for(;"\n"!==this.currentChar&&void 0!==this.currentChar;)this.advance()}return new Token("EOF",null)}}class Parser{constructor(e){this.lexer=e,this.currentToken=this.lexer.getNextToken()}eat(e){if(this.currentToken.type!==e)throw new Error(`Unexpected token: ${this.currentToken.type}. Expected ${e}.`);this.currentToken=this.lexer.getNextToken()}variableDeclaration(){this.eat("SAVA");let e=this.currentToken.value;this.eat("IDENTIFIER"),this.eat("AS");let t=this.currentToken.value;if("number"==t)this.eat("NUMBER_TYPE");else{if("string"!=t)throw new Error(`Unknown data type: ${t}`);this.eat("STRING_TYPE")}return{type:"VariableDeclaration",variableName:e,variableType:t}}assignmentStatement(){let e=this.currentToken.value;this.eat("IDENTIFIER");let t=this.currentToken.value;if("NUMBER"===this.currentToken.type)return this.eat("NUMBER"),{type:"AssignmentStatement",variableName:e,value:parseInt(t),variableType:"number"};if("STRING"===this.currentToken.type)return this.eat("STRING"),{type:"AssignmentStatement",variableName:e,value:t,variableType:"string"};if("IDENTIFIER"===this.currentToken.type){let r=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"AssignmentStatement",variableName:e,value:t,variableType:r}}throw new Error(`Invalid assignment value: ${t}`)}outputStatement(){if(this.eat("OUTPUT"),"NUMBER"===this.currentToken.type){let e=this.currentToken.value;return this.eat("NUMBER"),{type:"OutputStatement",value:e}}if("STRING"===this.currentToken.type){let e=this.currentToken.value;return this.eat("STRING"),{type:"OutputStatement",value:e}}{let e=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"OutputStatement",value:e,isVariable:!0}}}labelStatement(){this.eat("LABEL");let e=this.currentToken.value;return this.eat("IDENTIFIER"),this.eat("COLON"),{type:"LabelStatement",labelName:e}}gotoStatement(){this.eat("GOTO");let e=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"GotoStatement",labelName:e}}ifStatement(){this.eat("IF");let e=this.currentToken.value;this.eat("IDENTIFIER");let t=this.currentToken.value;if(">"===t)this.eat("GT");else if(">="===t)this.eat("GTE");else if("<"===t)this.eat("LT");else if("<="===t)this.eat("LTE");else{if("="!==t)throw new Error(`Invalid operator: ${t}`);this.eat("ASSIGN")}let r=this.currentToken.value;if("NUMBER"===this.currentToken.type){this.eat("NUMBER"),this.eat("THEN"),this.eat("GOTO");let a=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"IfStatement",variableName:e,operator:t,value:parseInt(r),label:a}}if("STRING"===this.currentToken.type){this.eat("STRING"),this.eat("THEN"),this.eat("GOTO");let a=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"IfStatement",variableName:e,operator:t,value:r,label:a}}if("IDENTIFIER"===this.currentToken.type){this.eat("IDENTIFIER"),this.eat("THEN"),this.eat("GOTO");let a=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"IfStatement",variableName:e,operator:t,value:r,label:a,isVariable:!0}}throw new Error(`Invalid if condition value: ${r}`)}incrementStatement(){let e=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"IncrementStatement",variableName:e}}decrementStatement(){let e=this.currentToken.value;return this.eat("IDENTIFIER"),{type:"DecrementStatement",variableName:e}}increaseByStatement(){let e=this.currentToken.value;this.eat("IDENTIFIER");let t,r=this.currentToken.type;return"NUMBER"===r?(t=this.currentToken.value,this.eat("NUMBER")):"STRING"===r?(t=this.currentToken.value,this.eat("STRING")):(t=this.currentToken.value,this.eat("IDENTIFIER")),{type:"IncreaseByStatement",variableName:e,displaceValue:t,variableType:r}}decreaseByStatement(){let e=this.currentToken.value;this.eat("IDENTIFIER");let t,r=this.currentToken.type;return"NUMBER"===r?(t=this.currentToken.value,this.eat("NUMBER")):(t=this.currentToken.value,this.eat("IDENTIFIER")),{type:"DecreaseByStatement",variableName:e,displaceValue:t,variableType:r}}statement(){if("SAVA"===this.currentToken.type)return this.variableDeclaration();if("IDENTIFIER"===this.currentToken.type){let e=this.lexer.getNextToken();if("ASSIGN"===e.type)return this.assignmentStatement();if("OUTPUT"===e.type)return this.outputStatement();if("INCREMENT"===e.type)return this.incrementStatement();if("DECREMENT"===e.type)return this.decrementStatement();if("INCREASEBY"===e.type)return this.increaseByStatement();if("DECREASEBY"===e.type)return this.decreaseByStatement();throw new Error(`Invalid statement: ${e.type}`)}if("LABEL"===this.currentToken.type)return this.labelStatement();if("GOTO"===this.currentToken.type)return this.gotoStatement();if("IF"===this.currentToken.type)return this.ifStatement();if("OUTPUT"===this.currentToken.type)return this.outputStatement();throw new Error(`Invalid statement: ${this.currentToken.type}`)}program(){let e=[];for(;"EOF"!==this.currentToken.type;)e.push(this.statement());return{type:"Program",statements:e}}parse(){return this.program()}}class Executor{constructor(e){this.ast=e,this.variables={},this.output=[],this.currentIndex=0}execute(){let e=0;for(;e<this.ast.statements.length;){let t=this.ast.statements[e],r=this.executeStatement(t);void 0===r?e++:e=r,this.currentIndex=e}return this.output}executeStatement(e){if("VariableDeclaration"===e.type)this.executeVariableDeclaration(e);else if("AssignmentStatement"===e.type)this.executeAssignmentStatement(e);else if("OutputStatement"===e.type)this.executeOutputStatement(e);else if("LabelStatement"!==e.type){if("GotoStatement"===e.type)return this.executeGotoStatement(e);if("IfStatement"===e.type)return this.executeIfStatement(e);if("IncrementStatement"===e.type)return this.executeIncrementStatement(e);if("DecrementStatement"===e.type)return this.executeDecrementStatement(e);if("IncreaseByStatement"===e.type)return this.executeIncreaseByStatement(e);if("DecreaseByStatement"===e.type)return this.executeDecreaseByStatement(e);throw new Error(`Invalid statement type: ${e.type}`)}}executeVariableDeclaration(e){let{variableName:t,variableType:r}=e;if("number"===r)this.variables[t]={value:0,variableType:r};else{if("string"!==r)throw new Error(`Invalid variable type: ${r}`);this.variables[t]={value:"",variableType:r}}}executeAssignmentStatement(e){let{variableName:t,value:r,variableType:a}=e;if(void 0===this.variables[t])throw new Error(`Variable not found: ${t}`);if(!["number","string"].includes(a)){if(void 0===this.variables[a])throw new Error(`Variable not found: ${a}`);if(this.variables[t].variableType===this.variables[a].variableType)return void(this.variables[t]={value:this.variables[a].value,variableType:this.variables[t].variableType});throw new Error(`Unexpected data type: ${this.variables[a].variableType}. Expected ${this.variables[t].variableType}.`)}if(this.variables[t].variableType!=a)throw new Error(`Unexpected data type: ${a}. Expected ${this.variables[t].variableType}.`);this.variables[t]={value:r,variableType:a}}executeOutputStatement(e){let{value:t,isVariable:r}=e;r?this.output.push(this.variables[t].value):this.output.push(t)}executeGotoStatement(e){let{labelName:t}=e;for(let e=0;e<this.ast.statements.length;e++)if("LabelStatement"===this.ast.statements[e].type&&this.ast.statements[e].labelName===t)return e;throw new Error(`Label not found: ${t}`)}executeIfStatement(e){let t,{variableName:r,operator:a,value:i,isVariable:n}=e,s=this.variables[r].value;if(n){if(void 0===this.variables[i])throw new Error(`Variable not found: ${r}`);i=this.variables[i].value}if(">"===a)t=s>i;else if(">="===a)t=s>=i;else if("<"===a)t=s<i;else if("<="===a)t=s<=i;else{if("="!==a)throw new Error(`Invalid operator: ${a}`);t=s===i}if(!t)return;let h=-1;for(var l=0;l<this.ast.statements.length;l++)if("LabelStatement"===this.ast.statements[l].type&&this.ast.statements[l].labelName===e.label){h=l;break}if(-1===h)throw new Error(`Label not found: ${e.label}`);return h}executeIncrementStatement(e){let{variableName:t}=e;if(void 0===this.variables[t])throw new Error(`Variable not found: ${t}`);if("number"!=this.variables[t].variableType)throw new Error(`${t} is not a number.`);this.variables[t]={value:this.variables[t].value+1,variableType:this.variables[t].variableType}}executeDecrementStatement(e){let{variableName:t}=e;if(void 0===this.variables[t])throw new Error(`Variable not found: ${t}`);if("number"!=this.variables[t].variableType)throw new Error(`${t} is not a number.`);this.variables[t]={value:this.variables[t].value-1,variableType:this.variables[t].variableType}}executeIncreaseByStatement(e){let{variableName:t,displaceValue:r,variableType:a}=e,i=this.variables[t];if(void 0===i)throw new Error(`Variable not found: ${t}`);if("IDENTIFIER"===a){if(void 0===this.variables[r])throw new Error(`Variable not found: ${r}`);if(this.variables[r].variableType=i.variableType)return void(this.variables[t]={value:i.value+this.variables[r].value,variableType:i.variableType});throw new Error(`Unexpected data type: ${this.variables[r].variableType}. Expected ${i.variableType}.`)}let n="string";if("number"===a&&(n="number",i.variableType!=n))throw new Error(`Unexpected data type: ${n}. Expected ${i.variableType}.`);this.variables[t]={value:i.value+r,variableType:n}}executeDecreaseByStatement(e){let{variableName:t,displaceValue:r,variableType:a}=e,i=this.variables[t];if(void 0===i)throw new Error(`Variable not found: ${t}`);if("IDENTIFIER"===a){if(void 0===this.variables[r])throw new Error(`Variable not found: ${r}`);if(this.variables[r].variableType=i.variableType)return void(this.variables[t]={value:i.value-this.variables[r].value,variableType:i.variableType});throw new Error(`Unexpected data type: ${this.variables[r].variableType}. Expected ${i.variableType}.`)}let n="number";if(i.variableType!=n)throw new Error(`Unexpected data type: ${n}. Expected ${i.variableType}.`);this.variables[t]={value:i.value-r,variableType:n}}}class SavaInterpreter{constructor(){console.log("Sava-Lang v0 (c) 2023 Ess2021"),this.lexer=null,this.parser=null,this.executor=null,this.outputs=[],this.errMsg=[]}run(e){try{this.lexer=new Lexer(e),this.parser=new Parser(this.lexer),this.executor=new Executor(this.parser.parse());let r=this.executor.execute();for(var t of(this.outputs=r,r))console.log(t)}catch(e){try{this.errMsg.push("Sava-Lang Runtime Error:"),this.errMsg.push(`  ${e.message}`),this.errMsg.push(`  at line ${this.executor.currentIndex+1}`)}catch(e){this.errMsg=[],this.errMsg.push("Sava-Lang Parse Error:"),this.errMsg.push(`  ${e.message}`)}throw new Error("Sava-Lang Runtime Error")}}}